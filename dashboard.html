<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard ‚Ä¢ Peer-to-Peer Skill Exchange</title>
  <link rel="stylesheet" href="styles.css">
  <script>
    // Prevent Flash of Light Mode
    if (localStorage.getItem("psx_theme") === "dark") document.body.classList.add("dark")
  </script>
  <script defer src="script.js?v=4"></script>
</head>

<body id="dashboard-page">
  <header class="header">
    <div class="logo"><a href="index.html">Peer-to-Peer Skill Exchange</a></div>
    <nav class="nav">
      <a href="index.html#features">Home</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="admin.html">Admin</a>
      <a href="#" class="logout-link">Logout</a>
      <div class="theme-toggle">üåì</div>
    </nav>
  </header>

  <main>
    <div class="dashboard-main" style="max-width:1200px; margin:0 auto; padding:30px 20px;">

      <!-- HEADER -->
      <div style="margin-bottom: 30px;">
        <h1 style="font-size: 2rem; font-weight: 700; margin: 0 0 4px 0;" class="dash-title">Dashboard</h1>
        <p style="font-size: 1rem; margin: 0;" class="dash-subtitle">Welcome back to PeerSkill</p>
      </div>

      <!-- TOP GRID -->
      <div class="dash-grid">
        <!-- Profile Card -->
        <section class="profile-card" style="padding:0; overflow:hidden;">
          <!-- Added 'soft-gradient-bg' for theme feeling -->
          <div style="padding:24px; display:flex; align-items:center; gap:20px;"
            class="profile-header-bg soft-gradient-bg">
            <!-- Avatar Left -->
            <div style="flex-shrink:0;">
              <img id="dashAvatar" src="profile_pictures/bot.png"
                style="width:64px; height:64px; border-radius:50%; object-fit:cover; border:3px solid rgba(255,255,255,0.8); box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
            </div>

            <!-- Info Right -->
            <div style="flex:1;">
              <div class="profile-name" id="dashName" style="font-size:1.25rem; font-weight:700; color:#1e293b;">
                <div class="skeleton skeleton-text" style="width:140px; height:1.4rem;"></div>
              </div>
              <div class="profile-meta" id="dashMeta" style="margin:4px 0 12px; font-size:0.9rem; color:#64748b;">
                <div class="skeleton skeleton-text" style="width:100px;"></div>
              </div>
              <a href="edit-profile.html" class="btn btn-secondary-sm">Edit Profile</a>
            </div>
          </div>
          <div class="profile-footer-stats">
            <div>
              <div class="profile-section-title">Teaching</div>
              <div id="teachTags" class="skills-tags" style="justify-content:flex-start"></div>
            </div>
            <div>
              <div class="profile-section-title">Learning</div>
              <div id="learnTags" class="skills-tags" style="justify-content:flex-start"></div>
            </div>
          </div>
        </section>

        <!-- Points & Actions -->
        <section class="card action-card-row">
          <div class="action-card-left">
            <h3 style="margin-top:0;">Skill Points</h3>
            <div class="points-display" id="dashBigPoints">
              <div class="skeleton skeleton-text" style="width:60px; height:2rem;"></div>
            </div>
            <div class="small-muted" style="margin-top:6px;">Target: 100 Pts</div>
          </div>
          <div class="action-card-right">
            <h4 style="margin:0 0 12px; font-size:1rem; color:#334155;" class="action-title">Raise Request</h4>
            <div style="display:flex; flex-direction:column; gap:8px; width:100%;">
              <input type="text" id="tokenInput" class="form-input-lg" placeholder="What do you need help with?"
                style="width:100%; border-radius:12px; padding:12px 16px; font-size:0.95rem;">
              <button class="btn btn-primary" id="raiseTokenBtn"
                style="width:100%; border-radius:12px; padding:10px;">Post Request</button>
            </div>
          </div>
        </section>
      </div>

      <!-- Main Content Grid -->
      <div class="main-dashboard-grid">

        <!-- Left Column -->
        <div class="left-col-stack">

          <!-- Recommendations -->
          <section class="peer-reco-card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
              <h3 class="section-accent-text" style="font-size:1.25rem; font-weight:700;">Recommended For You</h3>
              <span class="small-muted">Based on your "Learn" tags</span>
            </div>
            <div id="recoContainer">
              <div class="skeleton skeleton-card" style="height:80px"></div>
            </div>
          </section>

          <!-- Available Peers -->
          <section class="card align-left-card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
              <h3 class="section-accent-text" style="font-size:1.15rem; font-weight:700;">Explore Peers</h3>
              <input type="text" id="peerSearch" class="form-input" placeholder="Search name, skill..."
                style="width:200px; padding:6px 12px;">
            </div>
            <div id="randomPeersList" class="peers-grid-list">
              <div class="skeleton skeleton-card" style="height:70px"></div>
              <div class="skeleton skeleton-card" style="height:70px"></div>
            </div>
          </section>

          <!-- Community Requests -->
          <section class="card align-left-card">
            <h3 class="section-accent-text" style="font-size:1.15rem; font-weight:700;">Community Requests</h3>
            <div id="communityRequestsList" class="requests-grid-list"></div>
          </section>
        </div>

        <!-- Right Sidebar -->
        <div class="right-col-stack">

          <!-- Upcoming Sessions -->
          <div class="sidebar-card scrollable-card">
            <h3>üìÖ Upcoming Sessions</h3>
            <div id="upcomingList">
              <div class="skeleton skeleton-card" style="height:60px"></div>
            </div>
          </div>

          <!-- Leaderboard -->
          <div class="sidebar-card scrollable-card">
            <h3>üèÜ Top Contributors</h3>
            <div class="leaderboard-list" id="leaderboardList">
              <div class="skeleton skeleton-text"></div>
              <div class="skeleton skeleton-text"></div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </main>



  <!-- RATING MODAL -->
  <div class="modal-overlay" id="ratingModal">
    <div class="modal" style="text-align:center;">
      <div class="modal-header">
        <div class="modal-title">Rate Session</div>
        <div class="modal-close" onclick="closeRatingModal()">√ó</div>
      </div>
      <div class="modal-body">
        <input type="hidden" id="ratePeerEmail">
        <p style="margin-bottom:10px; color:#64748b;">How was your session with <b id="ratePeerName">Peer</b>?</p>

        <div class="star-rating">
          <div class="star" onclick="setRating(1)">‚òÖ</div>
          <div class="star" onclick="setRating(2)">‚òÖ</div>
          <div class="star" onclick="setRating(3)">‚òÖ</div>
          <div class="star" onclick="setRating(4)">‚òÖ</div>
          <div class="star" onclick="setRating(5)">‚òÖ</div>
        </div>
        <input type="hidden" id="selectedRating" value="0">

        <button class="btn btn-primary" onclick="submitRating()" style="width:100%">Submit Feedback</button>
      </div>
    </div>
  </div>

  <!-- SCHEDULING MODAL -->
  <div class="modal-overlay" id="scheduleModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Schedule Session</div>
        <div class="modal-close" onclick="closeModal()">√ó</div>
      </div>
      <div class="modal-body">
        <input type="hidden" id="modalPeerEmail">

        <div class="form-group">
          <label class="form-label">Session With</label>
          <input type="text" class="form-input" id="modalPeerName" readonly style="opacity:0.7">
        </div>

        <div class="form-group">
          <label class="form-label">Session Type</label>
          <select class="form-input" id="modalTopic">
            <option>General Mentorship</option>
            <option>Project Help</option>
            <option>Exam Prep</option>
            <option>Mock Interview</option>
            <option>Casual Chat</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Date</label>
          <input type="date" class="form-input" id="modalDate">
        </div>

        <div class="form-group">
          <label class="form-label">Time</label>
          <input type="time" class="form-input" id="modalTime">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="confirmSchedule()">Confirm Schedule</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    ¬© 2025 Peer-to-Peer Skill Exchange.
  </footer>

  <!-- ‚öôÔ∏è CONFIG -->
  <script src="config.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Logic handled in script.js to avoid duplication
      const userEmail = localStorage.getItem("userEmail")
      if (!userEmail) {
        window.location.href = "login.html"
      }
    })
  </script>
</body>

</html>